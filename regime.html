<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>Verificadora</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.2/math.js"></script>
<script src="https://domillan.github.io/dosimetria/main.js"></script>

<style>
.bt-info
{
 --bs-btn-padding-y: .05rem;
 --bs-btn-padding-x: .4rem;
 --bs-btn-font-size: .7rem;
 margin-left: 0.3rem;
}

.invisible
{
 opacity: 0;
 transition:visibility 0.2s linear, opacity 0.2s linear;
}

.accordion-button:focus{
  z-index:2;
}
</style>
</head>

<body data-bs-theme="dark">

<div id="aviso" style="right: 10%; width: 80%" class="aviso-panel invisible z-3 position-fixed bottom-0 bg-gradient container-fluid mt-5 mx-auto mb-3 bg-secondary  border border-white rounded"><div class="position-relative container-sm text-justify p-3">
<span id="avisoContent"></span>
</div>
<button id="fechaAviso" class="btn btn-md rounded position-absolute top-0 end-0">X</button>
</div>



<div class="container">
	<br/>
		<h2 class="text-center">Verificadora de regime, substituição e suspensão de pena</h2>
		<h6 class="text-end">Feito por <a href="http://lattes.cnpq.br/6702944102751831">Daniel Millan</a></h6>
	
	<hr>
	<br/>
	
	<a href="index.html"><h5 class="text-center">Voltar para a calculadora de dosimetria</h5></a>
	<br/>
	<div class="accordion" id="painel" data-bs-theme="light">
	
	  <div class="accordion-item">
		<div id="panelsStayOpen-collapseZero" class="accordion-collapse collapse show">
		<button value="regimes" class="bt-info rounded-circle btn btn-sm btn-outline-secondary">?</button>
		  <div class="accordion-body">
			<div class="row">
			<div class="col-md-4">
			<div class="input-group">
			  <span class="input-group-text p-3">
			  Anos
			  </span>
			  <input type="number" min="0" max="99" class="form-control" id="anos">
			</div></br>
			</div>
			
			<div class="col-md-4">
			<div class="input-group">
			  <span class="input-group-text p-3">
			  Meses
			  </span>
			  <input type="number" min="0" max="11" class="form-control" id="meses">
			</div></br>
			</div>
			
			<div class="col-md-4">
			<div class="input-group">
			  <span class="input-group-text p-3">
			  Dias
			  </span>
			  <input type="number" min="0" max="29" class="form-control" id="dias">
			</div></br>
			</div>
		  </div>
		  
		  <div class="row">
				<div class="col-md-6 my-auto">
				<div class="input-group">
				  <span class="input-group-text">&nbsp;&nbsp;Reincidente&nbsp;&nbsp;<button value="reinc" class="bt-info rounded-circle btn btn-sm btn-outline-secondary">?</button></span>
				  <select id="reinc" class="form-select p-3">
					<option selected value="0">Não, réu primário</option>
					<option value="1">Sim, reincidente em crime culposo</option>
					<option value="2">Sim, reincidente em crime doloso</option>
				  </select>
				</div><br>
				</div>
				<div class="col-md-6 my-auto">
				<div class="input-group">
				  <span class="input-group-text">Violência ou grave ameaça<button value="violencia" class="bt-info rounded-circle btn btn-sm btn-outline-secondary">?</button></span>
				  <select id="violencia" class="form-select p-3">
					<option selected value="0">Não, sem violência ou grave ameaça</option>
					<option value="1">Sim, com violência ou grave ameaça</option>
				  </select>
				</div><br>
				</div>
				</div>
				<div class="row">
				<div class="col-md-6 my-auto">
				<div class="input-group">
				  <span class="input-group-text">Circunstâncias<button value="circJ" class="bt-info rounded-circle btn btn-sm btn-outline-secondary">?</button></span>
				  <select id="circJ" class="form-select p-3">
				  <option value="1">Positivas</option>
				  <option value="0">Negativas</option>
				  </select>
				</div><br>
				</div>
				<div class="col-md-6 my-auto">
				<div class="input-group">
				  <span class="input-group-text">&nbsp;Crime doloso ou culposo&nbsp;<button value="doloso" class="bt-info rounded-circle btn btn-sm btn-outline-secondary">?</button></span>
				  <select id="dolo" class="form-select p-3">				  	
				  <option selected value="1">Crime doloso</option>
				  <option value="0">Crime culposo</option>
				  </select>
				</div><br>
				</div>
			</div>
			<div class="row">
				<div class="col-md-6 my-auto">
				<div class="input-group">
				  <span class="input-group-text">Crime hediondo<button value="hediondo" class="bt-info rounded-circle btn btn-sm btn-outline-secondary">?</button></span>
				  <select id="hediondo" class="form-select p-3">
				  <option value="0">Não</option>
				  <option value="1">Sim</option>
				  </select>
				</div><br>
				</div>
				<div class="col-md-6 my-auto">
				<div class="input-group">
				  <span class="input-group-text">Mais de 70 anos ou doente<button value="doente" class="bt-info rounded-circle btn btn-sm btn-outline-secondary">?</button></span>
				  <select id="doente" class="form-select p-3">
				  <option selected value="0">Não</option>
				  <option value="1">Sim</option>
				  </select>
				</div><br>
				</div>
			</div>
	  </div>
	  </div>
	  </div>
	  </div>
	
	<br>
	<button type="button" onclick="calcular()" class="mx-auto btn btn-primary  btn-lg">Calcular</button>
	<hr>
	
	<div class="accordion d-none" data-bs-theme="light"><div class="accordion-item row px-2" ><div class="accordion-body row">
	<ol id = "resultado"></ol>
	</div></div></div>
	<hr/>
	<br/>
	
</div>
<script>

var tempo;
var infos;

$(document).ready(function(){$.get( "https://domillan.github.io/dosimetria/info.json", (data)=>{infos = data;})});
function getUrlVars()
{
    var vars = {}, hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        //vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}
const vars = getUrlVars();
$('#anos').val(vars['a'] || 0);
$('#meses').val(vars['m'] || 0);
$('#dias').val(vars['d'] || 0);
$('#reinc').val(vars['r'] || 0);

$("select, button, input").click((e) => {$('#aviso').addClass('invisible')});
$("#fechaAviso").click((e) => {$('#aviso').addClass('invisible')});
$(".bt-info").click((e) => aviso(e));


function calcular(e)
{
	$(".d-none").removeClass("d-none");
	tempo = new Tempo($(anos).val(), $(meses).val(), $(dias).val());
	mostrar("<li>Pena de "+tempo.string()+"</li>", true);
	

	calculaRegime();
	if(calculaSubst()) mostrar("<li>Havendo substituição, não é possível a aplicação da Suspensão Condicional da Pena</li>");
	else calculaSuspens();

	let pos = $("#resultado").offset().top;
    $('body, html').animate({scrollTop: pos});
}

function calculaRegime()
{

	if(hediondo.value==1)
		mostrar("<li>Tratando-se de crime hediondo, <b>é possível aplicar um regime inicial mais grave</b>.</li>");

	if(reinc.value>0)
	{
		mostrar("<li>O réu é reincidente.</li>");
		if(tempo.anosTotal()>4)
		{
			mostrar("<li>A pena deve ser cumprida com regime inicial <b>fechado</b>.</li>");
		}
		else 
		{
			mostrar("<li>A pena deve ser cumprida com regime inicial <b>semi-aberto</b>.</li>");
		}
	}
	else
	{
		mostrar("<li>O réu não é reincidente.</li>");
		if(tempo.anosTotal()>8)
		{
			mostrar("<li>A pena será cumprida no regime inicial <b>fechado</b>.</li>");
		}
		else if(tempo.anosTotal()>4)
		{
			mostrar("<li>A pena deve ser cumprida com regime inicial <b>semi-aberto</b>.</li>");
		}
		else
		{
			mostrar("<li>A pena deve ser cumprida com regime inicial <b>aberto</b>.</li>");
		}
	}
	mostrar("</br>");
}

function calculaSubst()
{
	var subst = true;

	if(dolo.value == 0)
		mostrar("<li>Trata-se de crime culposo.</li>");
	else if(tempo.anosTotal()<=4)
	{
		mostrar("<li>A pena não é superior a quatro anos.</li>");
	}
	else{
		mostrar("<li><i>Trata-se de crime doloso com pena superior a quatro anos.</i></li>");
		subst = false;
	}

	if(violencia.value==0)
		mostrar("<li>O crime não foi cometido com violência ou grave ameaça.</li>");
	else{
		mostrar("<li><i>O crime foi cometido com violência ou grave ameaça.</i></li>");
		subst = false;
	}

	if(reinc.value<2)
		mostrar("<li>O réu não é reincidente em crime doloso.</li>");
	else{
		mostrar("<li><i>O réu é reincidente em crime doloso.</i></li>");
		subst = false;
	}

	if(circJ.value==1)
		mostrar("<li>As circunstâncias judiciais são favoráveis.</li>");
	else{
		mostrar("<li><i>As circunstâncias judiciais não são favoráveis.</i></li>");
		subst = false;
	}

	if(subst)
	{
		mostrar("<li>Conforme art. 44 do Código Penal, <b>é possível aplicar a substituição de pena.</b></li>");

		if(tempo.anosTotal()>1) mostrar("<li>A pena de prisão deve ser substituída por <b>multa e 1 pena restritiva de direitos</b> ou por <b>2 penas restritivas de direitos</b>.</li>");
		else mostrar("<li>A pena de prisão deve ser substituída por <b>multa</b> ou por <b>1 pena restritiva de direitos</b>.</li>");


	mostrar("</br>");
		return true;
	}
	mostrar("<li>Conforme art. 44 do Código Penal, <b>não é possível aplicar a substituição de pena.</b></li>");

	mostrar("</br>");
	return false;

}

function calculaSuspens()
{
	var susp = true;

	if(tempo.anosTotal()<=2)
	{
		mostrar("<li>A pena não é superior a dois anos.</li>");
	}
	else{
		mostrar("<li><i>A pena é superior a dois anos.</i></li>");
		susp = false;
	}

	if(reinc.value<2)
		mostrar("<li>O réu não é reincidente em crime doloso.</li>");
	else{
		mostrar("<li><i>O réu é reincidente em crime doloso.</i></li>");
		susp = false;
	}

	if(circJ.value==1)
		mostrar("<li>As circunstâncias judiciais são favoráveis.</li>");
	else{
		mostrar("<li><i>As circunstâncias judiciais não são favoráveis.</i></li>");
		susp = false;
	}

	if(susp)
	{
		mostrar("<li>Conforme art. 77 do Código Penal, <b>é possível suspender a pena.</b></li>");
		return;
	}
	if(doente.value==1 && tempo.anosTotal()<=4) mostrar("<li>Conforme art. 77, §2º, do Código Penal, <b>é possível suspender a pena</b> não superior a quatro anos pela idade e/ou saúde do réu.</li>");
	else mostrar("<li>Conforme art. 77 do Código Penal, <b>não é possível suspender a pena.</b></li>");
	return;
}


function aviso(e)
{
	html(infos[e.currentTarget.value], '#avisoContent', true);
	$('#aviso').removeClass('invisible');
	$(e.target).addClass('z-1');
}


</script>
<body>
</html>
